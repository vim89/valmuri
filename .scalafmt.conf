# .scalafmt.conf - Modern Scala formatting rules
version = "3.8.4"
runner.dialect = scala213source3
maxColumn = 120
style = defaultWithAlign

# File matching
project.git = true
project.excludeFilters = [
  ".*\\.sbt",
  "project/.*"
]

# Alignment
align.preset = most
align.multiline = false
align.openParenDefnSite = false
align.openParenCallSite = false
align.stripMargin = true

# Rewrites for modern Scala
rewrite.rules = [
  RedundantBraces,
  RedundantParens,
  SortModifiers,
  PreferCurlyFors,
  AvoidInfix,
  SortImports,
  AsciiSortImports
]

rewrite.redundantBraces.methodBodies = false
rewrite.redundantBraces.includeUnitMethods = false
rewrite.redundantBraces.stringInterpolation = true

# Trailing commas (essential for diffs)
rewrite.trailingCommas.style = "multiple"
rewrite.trailingCommas.allowFolding = true

# Import organization
rewrite.imports.sort = ascii
rewrite.imports.expand = true
rewrite.imports.contiguousGroups = no

# New lines
newlines.beforeMultiline = keep
newlines.beforeMultilineDef = keep
newlines.afterCurlyLambdaParams = preserve
newlines.implicitParamListModifierForce = [before]
newlines.avoidForSimpleOverflow = [punct]

# Indentation
indent.main = 2
indent.significant = 2
indent.callSite = 2
indent.defnSite = 2
indent.ctrlSite = 4
indent.caseSite = 4
indent.extendSite = 4
indent.withSiteRelativeToExtends = 2

# Spaces
spaces.inImportCurlyBraces = true
spaces.beforeContextBoundColon = Never
spaces.afterKeywordBeforeParen = true
spaces.inByNameTypes = true

# Comments and docs
docstrings.style = Asterisk
docstrings.oneline = fold
docstrings.wrap = yes

# Literals
literals.long = Upper
literals.float = Lower
literals.double = Lower

# XML formatting
xmlLiterals.assumeFormatted = true

# Vertical multiline
verticalMultiline.atDefnSite = true
verticalMultiline.arityThreshold = 3
verticalMultiline.newlineAfterOpenParen = true
